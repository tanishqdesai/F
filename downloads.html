<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FileShare - Downloads</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="navbar">
        <h1>FileShare</h1>
        <ul class="nav-links">
            <li><a href="index.html">Home</a></li>
            <li><a href="login.html" class="guest-link">Login</a></li>
            <li><a href="register.html" class="guest-link">Register</a></li>
            <li><a href="uploads.html" class="auth-link hidden">Upload</a></li>
            <li><a href="myfiles.html" class="auth-link hidden">My Files</a></li>
            <li><a href="#" class="auth-link hidden" onclick="logout()">Logout</a></li>
        </ul>
    </nav>

    <div class="container">
        <div class="card">
            <h2>Public Files</h2>
            <p>Browse and download files shared publicly by our users.</p>
            
            <div id="publicFiles" class="file-list">
                <!-- Public files are loaded here -->
                <p>Loading public files...</p>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        async function loadPublicFiles() {
            try {
                const response = await fetch(`${window.auth.API_URL}/files/public-files`);
                const files = await response.json();
                
                const filesList = document.getElementById('publicFiles');
                filesList.innerHTML = '';
                
                if (files.length === 0) {
                    filesList.innerHTML = '<p>No public files available yet.</p>';
                    return;
                }
                
                files.forEach(file => {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'file-item';
                    
                    fileItem.innerHTML = `
                        <div class="file-info">
                            <h4>${file.originalName}</h4>
                            <p>
                                <span class="public-badge">Public</span> • 
                                Size: ${window.auth.formatFileSize(file.size)} • 
                                Uploaded by: ${file.uploadedBy.username} • 
                                ${window.auth.formatDate(file.uploadedAt)}
                            </p>
                        </div>
                        <div class="file-actions">
                            <a href="${window.auth.API_URL}/files/${file._id}/download" class="btn" download>
                                Download
                            </a>
                        </div>
                    `;
                    
                    filesList.appendChild(fileItem);
                });
            } catch (error) {
                console.error('Error loading files:', error);
                document.getElementById('publicFiles').innerHTML = 
                    '<p class="alert alert-error">Error loading files. Please try again.</p>';
            }
        }
        
        // Checking the URL for share token
        const urlParams = new URLSearchParams(window.location.search);
        const shareToken = urlParams.get('token');
        
        if (shareToken) {
            // Load specific file via share token
            // Implement this endpoint to fetch file by shareableId
            alert('Share link detected. File access would be implemented here.');
        }
        
        // Load public files
        document.addEventListener('DOMContentLoaded', () => {
            window.auth.updateNavigation();
            loadPublicFiles();
        });
    </script>
</body>
</html>
